<!doctype html>
<html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>Azure Databricks DBFS and Interactive Ways with Local Image and Azure ADLS - Herman-blog</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="Icaurs - Hexo Theme"><meta name="msapplication-TileImage" content="/img/favicon1.ico"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="Icaurs - Hexo Theme"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta description="In today’s technology industry, Databricks has undoubtedly become a unicorn company in big data distributed processing, data analysis, data visualization, and machine learning. In the current era of c"><meta property="og:type" content="blog"><meta property="og:title" content="Azure Databricks DBFS and Interactive Ways with Local Image and Azure ADLS"><meta property="og:url" content="https://hermanteng19.github.io/2024/03/12/Azure-Databricks-DBFS-and-Interactive-Ways-with-Local-Image-and-Azure-ADLS/"><meta property="og:site_name" content="Herman-blog"><meta property="og:description" content="In today’s technology industry, Databricks has undoubtedly become a unicorn company in big data distributed processing, data analysis, data visualization, and machine learning. In the current era of c"><meta property="og:locale" content="en_US"><meta property="og:image" content="https://hermanteng19.github.io/img/adls_databricks_banner.png"><meta property="article:published_time" content="2024-03-12T19:24:42.000Z"><meta property="article:modified_time" content="2024-03-28T14:29:49.249Z"><meta property="article:author" content="Herman Teng"><meta property="article:tag" content="Azure"><meta property="article:tag" content="ADLS"><meta property="article:tag" content="Databricks"><meta property="article:tag" content="DBFS"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="/img/adls_databricks_banner.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://hermanteng19.github.io/2024/03/12/Azure-Databricks-DBFS-and-Interactive-Ways-with-Local-Image-and-Azure-ADLS/"},"headline":"Herman-blog","image":["https://hermanteng19.github.io/img/adls_databricks_banner.png"],"datePublished":"2024-03-12T19:24:42.000Z","dateModified":"2024-03-28T14:29:49.249Z","author":{"@type":"Person","name":"Herman Teng"},"description":"In today’s technology industry, Databricks has undoubtedly become a unicorn company in big data distributed processing, data analysis, data visualization, and machine learning. In the current era of c"}</script><link rel="canonical" href="https://hermanteng19.github.io/2024/03/12/Azure-Databricks-DBFS-and-Interactive-Ways-with-Local-Image-and-Azure-ADLS/"><link rel="icon" href="/img/favicon1.ico"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.12.0/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-dark.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css"><script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script><meta name="generator" content="Hexo 5.2.0"></head><body class="is-3-column"><nav class="navbar navbar-main"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/avatar1.png" alt="Herman-blog" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/about">About</a></div><div class="navbar-end"><a class="navbar-item is-hidden-tablet catalogue" title="Catalogue" href="javascript:;"><i class="fas fa-list-ul"></i></a><a class="navbar-item search" title="Search" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main"><div class="card"><div class="card-image"><span class="image is-7by3"><img class="fill" src="/img/adls_databricks_banner.png" alt="Azure Databricks DBFS and Interactive Ways with Local Image and Azure ADLS"></span></div><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2024-03-12T19:24:42.000Z" title="2024-03-12T19:24:42.000Z">2024-03-12</time></span><span class="level-item">Updated&nbsp;<time dateTime="2024-03-28T14:29:49.249Z" title="2024-03-28T14:29:49.249Z">2024-03-28</time></span><span class="level-item">6 minutes read (About 951 words)</span></div></div><h1 class="title is-3 is-size-4-mobile">Azure Databricks DBFS and Interactive Ways with Local Image and Azure ADLS</h1><div class="content"><p>In today’s technology industry, Databricks has undoubtedly become a unicorn company in big data distributed processing, data analysis, data visualization, and machine learning. In the current era of cloud computing, the three major cloud service providers, Microsoft, Amazon, and Google, have all incorporated Databricks into their cloud computing platforms. This shows Databricks’ unique contribution to data cloud computing and its pivotal role in the development of enterprise-level data products.</p>
<p>With the decreasing cost of cloud storage and the improvement in network speeds, more and more enterprises are choosing to store all their data in a central repository rather than separately storing different types of data. This trend towards centralization helps companies better understand their business operations through real-time business intelligence and predictive analytics. At the same time, the explosive growth of data has made it impractical for companies to maintain multiple large data stores, leading to the merging of data lakes and data warehouses into a single platform. Based on the Lakehouse technology architecture, Databricks provides platform-level services that integrate data storage, processing, visualization, and machine learning into a unified environment. As a result, more and more enterprises are choosing Databricks as their primary cloud data service platform, and developers also prefer Databricks Notebook as a unified development and presentation environment.</p>
<a id="more"></a>

<p>Recently, in the process of coordinating with the engineering team of our business product supplier, we needed a large number of scripts and images for development and presentation. It is clearly not a good practice to frequently switch between the development environment and image applications. Therefore, we need a method to integrate images into Databricks notebooks and combine them with its dashboard functionality to present data, charts, and images together. This can greatly improve the user experience.</p>
<h2 id="Insert-images-in-Databricks-notebook"><a href="#Insert-images-in-Databricks-notebook" class="headerlink" title="Insert images in Databricks notebook"></a>Insert images in Databricks notebook</h2><p>First of all, we need to upload the images to Databricks DBFS file system and it is very similar to the upload data file through the <code>Add data</code> GUI, as shown in the following, in the catalog homepage of your workspace, click <code>Add data</code> button on the up right corner (position might different depends on version), then click <code>DBFS</code> tile. Usually, we store file in <code>FileStore</code> directory which is prebuilt for customer data/file, in our case, we upload images file in <code>/FileStore/tables/images/</code> directory.</p>
<img src="https://i.ibb.co/NCcFbgQ/IMG-20240321-083003.jpg" alt="Databricks DBFS" style="zoom:50%;" />

<img src="https://i.ibb.co/4Kk6cq8/IMG-20240321-085452.jpg" alt="Databricks Add Data" style="zoom:50%;" />

<p>Because Databrick notebook supports markdown so that you might think the only thing for this task is copy the path which is generated automatically when uploading completed like <code>/FileStore/</code>, it may seem to be right, but that is tricky one, we need to replace <strong>FileStore</strong> with <strong><em>files</em></strong> otherwise, it won’t show anything in the cell, another thing we need to pay attention is the path should be directly written inside the parenthesis <strong>without quote</strong>, as shown down below</p>
<img src="https://i.ibb.co/5WhpzTj/IMG-20240321-091915.jpg" alt="Insert image to cell" style="zoom:50%;" />

<img src="https://i.ibb.co/9WR9PjD/IMG-20240321-091941.jpg" alt="Image in cell" style="zoom:50%;" />

<h2 id="Access-Azure-Datalake-Gen2-Storage-with-Azure-Databricks"><a href="#Access-Azure-Datalake-Gen2-Storage-with-Azure-Databricks" class="headerlink" title="Access Azure Datalake Gen2 Storage with Azure Databricks"></a>Access Azure Datalake Gen2 Storage with Azure Databricks</h2><p>Another use case is reading a huge amount of data from an external data source. Although Databricks provides GUI data upload functionality, it is limited to small test data sets. In actual production scenarios, data is mostly read from Azure Data Lake Storage (ADLS) and then written to Delta Lake. With the unified platform advantage of Azure Databricks and Azure Data Lake Storage (ADLS), we can directly read data from ADLS into Databricks and also mount the ADLS container directly to the Databricks DBFS file system.</p>
<h3 id="Write-ADLS-Data-to-Delta-Lake"><a href="#Write-ADLS-Data-to-Delta-Lake" class="headerlink" title="Write ADLS Data to Delta Lake"></a>Write ADLS Data to Delta Lake</h3><p>There are two ways to ADLS storage account container</p>
<ol>
<li>Access Key</li>
<li>Shared Access Signatures (SAS)</li>
</ol>
<p>SAS gives more control on the access, Databricks recommends using a service principal or a SAS to connect ADLS instead of access key, but for simplify our demo, we will discuss the way by using access keys, it provides full access to the configuration of a storage account, as well as the data.</p>
<p>Step1, we need to login Azure portal and ADLS account to get the account name and access key, then define the data file path and the file type, next set Spark properties to configure a Azure credentials to access Azure storage. The credentials can be scoped to either a cluster or a notebook.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">storage_account_name = <span class="string">&quot;adlstest1&quot;</span></span><br><span class="line">storage_account_access_key = <span class="string">&quot;sfjdkslafskdjflsj84938sljflr902u20sdfJULHHH830==&quot;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">file_location = <span class="string">&quot;abfss://testContainer1@adlstest1.dfs.core.windows.net/test_file.csv&quot;</span></span><br><span class="line">file_type = <span class="string">&quot;csv&quot;</span></span><br></pre></td></tr></table></figure>

<p><img src="https://i.ibb.co/DkLLgkC/IMG-20240321-172554.jpg" alt="ADLS Access Key"></p>
<p>File path parameter is consist of “abfss://“ + {container name}@{storage account name} + “.dfs.core.windows.net/“ + {file name}. Here is a tricky thing of the path, the path is only valid when data file is in container (files can’t be put into subfolder in the container otherwise the path wouldn’t work) so that Databricks can’t read file from below path</p>
<p><del>“file_location = “abfss://testContainer1@adlstest1.dfs.core.windows.net/data_file/test_file.csv”</del></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># configure Azure credentials</span></span><br><span class="line">spark.conf.<span class="built_in">set</span>(<span class="string">&quot;fs.azure.account.key.&quot;</span>+storage_account_name+<span class="string">&quot;.dfs.core.windows.net&quot;</span>,</span><br><span class="line">              storage_account_access_key)</span><br></pre></td></tr></table></figure>

<p>Step 2, we have specified out file metadata, we can create a Dataframe. Notice that we use an <em>option</em> to specify that we want to infer the schema from the file. We can also explicitly set this to a particular schema if we have one already</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df = spark.read.<span class="built_in">format</span>(file_type).option(<span class="string">&quot;header&quot;</span>, <span class="string">&quot;true&quot;</span>).option(<span class="string">&quot;inferSchema&quot;</span>, <span class="string">&quot;true&quot;</span>).load(file_location)</span><br></pre></td></tr></table></figure>

<p><img src="https://i.ibb.co/2659hSR/IMG-20240321-215327.jpg" alt="Databricks Notebook Code Snippet"></p>
<p>We can also reference a video in YouTube on this technology</p>
<div style="padding:48.17% 0 0 0;position:relative;">
<iframe width="560" height="315" src="https://www.youtube.com/embed/M11IIy8UXR8?si=uiMdwaY1ML3yvlST" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen style="position:absolute;top:0;left:0;width:100%;height:100%;"></iframe>
</div>



<h3 id="Mount-ADLS-Container-to-Databricks-DBFS"><a href="#Mount-ADLS-Container-to-Databricks-DBFS" class="headerlink" title="Mount ADLS Container to Databricks DBFS"></a>Mount ADLS Container to Databricks DBFS</h3><p> There is a great article in <code>Medium</code> to introduce that technology with name <a target="_blank" rel="noopener" href="https://medium.com/@nakhtar.etc/mount-adls-on-databricks-fe3b54da07be"><strong>Mount ADLS on Databricks</strong></a>, click the article name to redirect to the article site.</p>
</div><div class="article-tags is-size-7 mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/tags/Azure/">Azure</a><a class="link-muted mr-2" rel="tag" href="/tags/ADLS/">ADLS</a><a class="link-muted mr-2" rel="tag" href="/tags/Databricks/">Databricks</a><a class="link-muted mr-2" rel="tag" href="/tags/DBFS/">DBFS</a></div><div class="a2a_kit a2a_kit_size_32 a2a_default_style"><a class="a2a_dd" target="_blank" rel="noopener" href="https://www.addtoany.com/share"></a><a class="a2a_button_facebook"></a><a class="a2a_button_twitter"></a><a class="a2a_button_telegram"></a><a class="a2a_button_whatsapp"></a><a class="a2a_button_reddit"></a></div><script src="https://static.addtoany.com/menu/page.js" defer></script></article></div><!--!--><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/2024/03/28/Azure-Databricks-Notebooks-Modulization-and-Interaction/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">Azure Databricks Notebooks Modulization and Interaction</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/2022/06/10/Github-Pages-Hosts-A-Website-with-A-Custom-Domain/"><span class="level-item">Github Pages Hosts A Website with A Custom Domain</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><div class="card"><div class="card-content"><h3 class="title is-5">Comments</h3><div id="disqus_thread"><noscript>Please enable JavaScript to view the <a target="_blank" rel="noopener" href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div><script>var disqus_config = function () {
            this.page.url = 'https://hermanteng19.github.io/2024/03/12/Azure-Databricks-DBFS-and-Interactive-Ways-with-Local-Image-and-Azure-ADLS/';
            this.page.identifier = '2024/03/12/Azure-Databricks-DBFS-and-Interactive-Ways-with-Local-Image-and-Azure-ADLS/';
        };
        (function() {
            var d = document, s = d.createElement('script');  
            s.src = '//' + 'herman-hexo-blog' + '.disqus.com/embed.js';
            s.setAttribute('data-timestamp', +new Date());
            (d.head || d.body).appendChild(s);
        })();</script></div></div></div><div class="column column-left is-4-tablet is-4-desktop is-3-widescreen  order-1 is-sticky"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar is-rounded" src="/img/avatar1.png" alt="Herman"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">Herman</p><p class="is-size-6 is-block">Data Analyst&amp;Developer</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>Toronto, Canada</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">Posts</p><a href="/archives"><p class="title">27</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Categories</p><a href="/categories"><p class="title">8</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Tags</p><a href="/tags"><p class="title">76</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/HermanTeng19" target="_blank" rel="noopener">Follow</a></div><div class="level is-mobile"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/HermanTeng19"><i class="fab fa-github"></i></a></div></div></div><div class="card widget" id="toc" data-type="toc"><div class="card-content"><div class="menu"><h3 class="menu-label">Catalogue</h3><ul class="menu-list"><li><a class="level is-mobile" href="#Insert-images-in-Databricks-notebook"><span class="level-left"><span class="level-item">1</span><span class="level-item">Insert images in Databricks notebook</span></span></a></li><li><a class="level is-mobile" href="#Access-Azure-Datalake-Gen2-Storage-with-Azure-Databricks"><span class="level-left"><span class="level-item">2</span><span class="level-item">Access Azure Datalake Gen2 Storage with Azure Databricks</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#Write-ADLS-Data-to-Delta-Lake"><span class="level-left"><span class="level-item">2.1</span><span class="level-item">Write ADLS Data to Delta Lake</span></span></a></li><li><a class="level is-mobile" href="#Mount-ADLS-Container-to-Databricks-DBFS"><span class="level-left"><span class="level-item">2.2</span><span class="level-item">Mount ADLS Container to Databricks DBFS</span></span></a></li></ul></li></ul></div></div><style>#toc .menu-list > li > a.is-active + .menu-list { display: block; }#toc .menu-list > li > a + .menu-list { display: none; }</style><script src="/js/toc.js" defer></script></div><div class="column-right-shadow is-hidden-widescreen"></div></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/avatar1.png" alt="Herman-blog" height="28"></a><p class="is-size-7"><span>&copy; 2024 Herman Teng</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p></div><div class="level-end"></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" async></script><script>moment.locale("en");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="Back to top" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "This website uses cookies to improve your experience.",
          dismiss: "Got it!",
          allow: "Allow cookies",
          deny: "Decline",
          link: "Learn more",
          policy: "Cookie Policy",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="Type something..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"Type something...","untitled":"(Untitled)","posts":"Posts","pages":"Pages","categories":"Categories","tags":"Tags"});
        });</script></body></html>
<!doctype html>
<html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>Automation Process for Email Attachment Excel in Python - Herman-blog</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="Icaurs - Hexo Theme"><meta name="msapplication-TileImage" content="/img/favicon1.ico"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="Icaurs - Hexo Theme"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta description="Working with business data, Excel spreadsheet is the most common file type you might deal with in daily basis, because Excel is a dominated application in the business world. What is the most used way"><meta property="og:type" content="blog"><meta property="og:title" content="Automation Process for Email Attachment Excel in Python"><meta property="og:url" content="https://hermanteng19.github.io/2020/12/15/Automation-Process-for-Email-Attachment-Excel-in-Python/"><meta property="og:site_name" content="Herman-blog"><meta property="og:description" content="Working with business data, Excel spreadsheet is the most common file type you might deal with in daily basis, because Excel is a dominated application in the business world. What is the most used way"><meta property="og:locale" content="en_US"><meta property="og:image" content="https://hermanteng19.github.io/img/pythonexcelribbon.webp"><meta property="article:published_time" content="2020-12-16T03:28:10.000Z"><meta property="article:modified_time" content="2021-11-28T00:44:19.693Z"><meta property="article:author" content="Herman Teng"><meta property="article:tag" content="python, automation, ETL, Excel"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="/img/pythonexcelribbon.webp"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://hermanteng19.github.io/2020/12/15/Automation-Process-for-Email-Attachment-Excel-in-Python/"},"headline":"Herman-blog","image":[],"datePublished":"2020-12-16T03:28:10.000Z","dateModified":"2021-11-28T00:44:19.693Z","author":{"@type":"Person","name":"Herman Teng"},"description":"Working with business data, Excel spreadsheet is the most common file type you might deal with in daily basis, because Excel is a dominated application in the business world. What is the most used way"}</script><link rel="canonical" href="https://hermanteng19.github.io/2020/12/15/Automation-Process-for-Email-Attachment-Excel-in-Python/"><link rel="icon" href="/img/favicon1.ico"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.12.0/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-dark.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css"><script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script><meta name="generator" content="Hexo 5.2.0"></head><body class="is-3-column"><nav class="navbar navbar-main"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/avatar1.png" alt="Herman-blog" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/about">About</a></div><div class="navbar-end"><a class="navbar-item is-hidden-tablet catalogue" title="Catalogue" href="javascript:;"><i class="fas fa-list-ul"></i></a><a class="navbar-item search" title="Search" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main"><div class="card"><div class="card-image"><span class="image is-7by3"><img class="fill" src="/img/pythonexcelribbon.webp" alt="Automation Process for Email Attachment Excel in Python"></span></div><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2020-12-16T03:28:10.000Z" title="2020-12-16T03:28:10.000Z">2020-12-15</time></span><span class="level-item">Updated&nbsp;<time dateTime="2021-11-28T00:44:19.693Z" title="2021-11-28T00:44:19.693Z">2021-11-27</time></span><span class="level-item"><a class="link-muted" href="/categories/Data-BI/">Data, BI</a></span><span class="level-item">11 minutes read (About 1687 words)</span></div></div><h1 class="title is-3 is-size-4-mobile">Automation Process for Email Attachment Excel in Python</h1><div class="content"><p>Working with business data, <strong>Excel spreadsheet</strong> is the most common file type you might deal with in daily basis, because Excel is a dominated application in the business world. What is the most used way to transfer those Excel files for business operation team, obviously, it’s <strong>Outlook</strong>, because email attachment is the easiest way for business team to share data and reports. Following this business common logic and convention, you may get quite a lot Excel files from email attachment when you involved into a business initiative or project to design a data solution for BI reporting and business analysis.</p>
<p>The pain points is too much manual work dragging down efficiency of data availability and also increasing the possibility of human error. Imagine, every day get data from email attachment, you need to check your inbox every once for a while, then download those files from attachment, open Excel to edit data or rename file to meet data process requirement such as remove the protected password, after those preparation works all done, push data to NAS drive, finally, launch the job to proceed the data. It’s not surprise that how easily you might make mistake because any single step contains error would cause the whole process failed.</p>
<p>It’s very necessary to automate the whole data process if business project turns to BAU (Business As Usual) program and you have to proceed data in regular ongoing basis. <code>Python</code> and <code>Windows Task Scheduler</code> provides a simple and fast way to solve this problem, now let’s take a look.</p>
<p>Overall speaking, this task can be broken down by a couple of steps:</p>
<ol>
<li>Access Outlook to read email and download the attachment</li>
<li>Remove Excel file protected password (it’s common in business file to protect data privacy)</li>
<li>Manipulate and edit Excel file</li>
<li>Copy file to NAS drive</li>
<li>Setup the Windows Task Scheduler to run python script automatically.</li>
</ol>
<p><img src="/img/screenshots/emailexcelmindset.png" alt="emailexcelmindset.png"></p>
<a id="more"></a>

<h2 id="Interact-Outlook-and-Excel-with-Python"><a href="#Interact-Outlook-and-Excel-with-Python" class="headerlink" title="Interact Outlook and Excel with Python"></a>Interact Outlook and Excel with Python</h2><p>In this case, we are focusing on local operation because server setting is vary for different production environment. Python standard library can’t meet our need on this request, we have to leverage its third-party libraries to access outlook and interact with Excel so we are going to import <code>win32com</code>, <code>openpyxl</code> and <code>shutil</code>. We firstly work out workflow to guide us to compose the python scripts</p>
<p><img src="/img/screenshots/attachmentexceltaskworkflow.png" alt="attachmentexceltaskworkflow.png"></p>
<p>From the workflow chart, we can tell there are four functions in the streamline. The first one is read email and download attachment <code>readmail()</code>, this step is critical and the most import business logic build-in it.</p>
<p><img src="/img/screenshots/readmail_fn.png" alt="readmail_fn.png"></p>
<p>we are going to apply two business logics, one is the latest email, the other one is if the email is latest (current date) then check if the current date -1 equals to data date in the subject line. we will process file when all the requirements are satisfied.</p>
<p>For Excel manipulation and spreadsheet decryption are pretty straight forward, no additional business logic so just apply the single function.  We create 3 python module files then encapsulate them into the main readmail() function script.</p>
<h3 id="fileTransfer-module-py"><a href="#fileTransfer-module-py" class="headerlink" title="fileTransfer_module.py"></a>fileTransfer_module.py</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> win32com.client <span class="keyword">as</span> win32</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> os.path</span><br><span class="line"><span class="keyword">import</span> openpyxl <span class="keyword">as</span> xl</span><br><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime, timedelta</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> shutil</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">cpfile</span>(<span class="params">src_file, tgt_file</span>):</span></span><br><span class="line">    <span class="keyword">if</span> os.path.exists(tgt_file):</span><br><span class="line">        os.remove(tag_file)</span><br><span class="line">        shutil.copy(src_file, tgt_file)</span><br><span class="line">        </span><br><span class="line">	<span class="keyword">else</span>:</span><br><span class="line">        shutil.copy(src_file, tgt_file)</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    cpfile(src_file, tgt_file)</span><br></pre></td></tr></table></figure>

<h3 id="excelOp-mudule-py"><a href="#excelOp-mudule-py" class="headerlink" title="excelOp_mudule.py"></a>excelOp_mudule.py</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> openpyxl <span class="keyword">as</span> xl</span><br><span class="line"><span class="keyword">from</span> file_Transfer_module <span class="keyword">import</span> cpfile</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">xltemp</span>(<span class="params">file, file_ind</span>):</span></span><br><span class="line">    prd_dir = <span class="string">r&quot;\\your NAS drive UNC address&quot;</span></span><br><span class="line">    <span class="keyword">if</span> file_ind == <span class="number">0</span>: <span class="comment">## for dealing with multiple Excel files</span></span><br><span class="line">        fn = <span class="string">&quot;yourExcelFile_1.xlsx&quot;</span></span><br><span class="line">        desc_fn = prd_dir + os.sep + fn</span><br><span class="line">        cpfile(file, desc_fn)</span><br><span class="line">	<span class="keyword">elif</span> file_ind == <span class="number">2</span>:</span><br><span class="line">        fn = <span class="string">&quot;yourExcelFile_2.xlsx&quot;</span></span><br><span class="line">        desc_fn = prd_dir + os.sep + fn</span><br><span class="line">        cpfile(file, desc_fn)</span><br><span class="line">	<span class="keyword">elif</span> file_ind == <span class="number">1</span>: <span class="comment">## Excel file need to be manipulated</span></span><br><span class="line">        wb_raw = xl.load_workbook(file)</span><br><span class="line">        fn_tgt = <span class="string">&quot;yourExcelFile_3.xlsx&quot;</span></span><br><span class="line">        desc_file = prd_dir + os.sep + fn_tgt</span><br><span class="line">        wb_tgt = xl.Workbook()</span><br><span class="line">        ws_tgt = wb_tgt.active</span><br><span class="line">        ws_tgt.title = <span class="string">&quot;Sheet1&quot;</span> <span class="comment">## define work sheet name</span></span><br><span class="line">        ws_tgt[<span class="string">&#x27;A1&#x27;</span>] = <span class="string">&quot;Date&quot;</span> <span class="comment">## define the first column name</span></span><br><span class="line">        ws_tgt[<span class="string">&#x27;B1&#x27;</span>] = <span class="string">&quot;ID&quot;</span></span><br><span class="line">        ws_tgt[<span class="string">&#x27;C1&#x27;</span>] = <span class="string">&quot;Type&quot;</span></span><br><span class="line">        ws_tgt[<span class="string">&#x27;D1&#x27;</span>] = <span class="string">&quot;Amt&quot;</span></span><br><span class="line">        ws_tgt[<span class="string">&#x27;E1&#x27;</span>] = <span class="string">&quot;Info&quot;</span></span><br><span class="line">        cur_sheet = <span class="built_in">str</span>((datetime.today().day) - <span class="number">1</span>)</span><br><span class="line">        ws_src = wb_raw.get_sheet_by_name(cur_sheet)</span><br><span class="line">        <span class="number">1</span> = <span class="number">1</span></span><br><span class="line">        row_lt = []</span><br><span class="line">        <span class="keyword">for</span> each <span class="keyword">in</span> ws_src.rows:</span><br><span class="line">            <span class="keyword">if</span> each[<span class="number">0</span>].value <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">                row_lt.append(i)</span><br><span class="line">                i += <span class="number">1</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">	    num_max_row_raw = row_lt.pop()</span><br><span class="line">        num_max_col = ws_tgt.max_column</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>, num_max_row_raw+<span class="number">1</span>):</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, num_max_col+<span class="number">1</span>):</span><br><span class="line">                c = ws_src.cell(row = i, column = j)</span><br><span class="line">                ws_tgt.cell(row = i, column = j).value = c.value</span><br><span class="line">                </span><br><span class="line">		wb_tgt.save(desc_file)</span><br><span class="line">         wb_tgt.close()</span><br><span class="line">         wb_raw.close()</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    xltemp(file, file_ind)</span><br></pre></td></tr></table></figure>

<h3 id="pwdDecry-module-py"><a href="#pwdDecry-module-py" class="headerlink" title="pwdDecry_module.py"></a>pwdDecry_module.py</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> win32com.client <span class="keyword">as</span> win32</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> os.path</span><br><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">xlpwd</span>():</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    function xlpwd() is aiming to peel off attachment excel file password</span></span><br><span class="line"><span class="string">	to be able to be ready by program</span></span><br><span class="line"><span class="string">	arg: opt1_opt2</span></span><br><span class="line"><span class="string">	value: &quot;opt1&quot; to deal with one excel file; &quot;opt2&quot; to deal with another excel file</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">	opt1_opt2 = sys.argv[<span class="number">1</span>]</span><br><span class="line">	excel = win32.Dispatch(<span class="string">&#x27;Excel.Application&#x27;</span>)</span><br><span class="line">	mon = <span class="string">&#x27;0&#x27;</span> + <span class="built_in">str</span>(datetime.today().month) <span class="comment">## suppose password is letters and 2 digits month combination</span></span><br><span class="line">	<span class="keyword">if</span> opt1_opt2 = <span class="string">&quot;opt1&quot;</span>:</span><br><span class="line">    	pwd = <span class="string">&quot;randomletters&quot;</span> + mon</span><br><span class="line">    	fn = <span class="string">&quot;yourExcelFile_1.xlsx&quot;</span></span><br><span class="line">    	sn = <span class="number">2</span> <span class="comment">## sheet number</span></span><br><span class="line">    	st = <span class="string">&quot;tab name 1&quot;</span></span><br><span class="line">	<span class="keyword">elif</span> opt1_opt2 = <span class="string">&quot;opt2&quot;</span>:</span><br><span class="line">    	pwd = <span class="string">&quot;otherrandomletters&quot;</span> + mon</span><br><span class="line">    	fn = <span class="string">&quot;yourExcelFile_2.xlsx&quot;</span></span><br><span class="line">    	sn = <span class="number">1</span></span><br><span class="line">    	st = <span class="string">&quot;other tab name&quot;</span></span><br><span class="line">	prd_dir = <span class="string">r&quot;\\your NAS UNC address&quot;</span></span><br><span class="line">	file = prd_dir + os.sep + fn</span><br><span class="line">	wb_tgt = excel.Workbooks.<span class="built_in">open</span>(file,<span class="number">0</span>,<span class="literal">False</span>,<span class="number">5</span>,pwd) <span class="comment">## open encrypted Excel file</span></span><br><span class="line">	wb_tgt.Password = <span class="string">&quot;&quot;</span> <span class="comment">## remove password</span></span><br><span class="line">	wb_tgt.Worksheets(sn).Name = st <span class="comment">## define the tagart worksheet order and name</span></span><br><span class="line">	wb_tgt.Save()</span><br><span class="line">	wb_tgt.Close()</span><br><span class="line">	excel.Quit()</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    xlpwd()</span><br></pre></td></tr></table></figure>
<h3 id="readMail-py"><a href="#readMail-py" class="headerlink" title="readMail.py"></a>readMail.py</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os, os.path</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime, timedelta</span><br><span class="line"><span class="keyword">import</span> win32com.client <span class="keyword">as</span> win32</span><br><span class="line"><span class="keyword">from</span> excelOp_mudule <span class="keyword">import</span> xltemp</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">readMail</span>():</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    function readMail is aiming to read outlook email attachment and download them</span></span><br><span class="line"><span class="string">    arg: lob, app, c_type</span></span><br><span class="line"><span class="string">    value: lob == &#x27;you line of business&#x27; and app == &#x27;application name generate the source file&#x27; and c_type == &#x27;business category&#x27;</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    lob = sys.argv[<span class="number">1</span>]</span><br><span class="line">    app = sys.argv[<span class="number">2</span>]</span><br><span class="line">    c_type = sys.argv[<span class="number">3</span>]</span><br><span class="line">    outlook = win32.Dispatch(<span class="string">&quot;Outlook.Application&quot;</span>).GetNameSpace(<span class="string">&quot;MAPI&quot;</span>)</span><br><span class="line">    type1 = outlook.Folders[<span class="string">&quot;your email address&quot;</span>].Folders[<span class="string">&quot;your inbox subfolder1&quot;</span>]</span><br><span class="line">    type2 = outlook.Folders[<span class="string">&quot;your email address&quot;</span>].Folders[<span class="string">&quot;your inbox subfolder2&quot;</span>]</span><br><span class="line">    type3 = outlook.Folders[<span class="string">&quot;your email address&quot;</span>].Folders[<span class="string">&quot;your inbox subfolder3&quot;</span>]</span><br><span class="line">    <span class="comment">## if your inbox subfolder name has convention you can use while loop</span></span><br><span class="line">    inbox = outlook.GetDefaultFolder(<span class="number">6</span>) <span class="comment">## Microsoft Outlook API number for inbox is 6</span></span><br><span class="line">    type1_msgs = type1.Items</span><br><span class="line">    type2_msgs = type2.Items</span><br><span class="line">    type3_msgs = type3.Items</span><br><span class="line">    inbox_msgs = inbox.Items</span><br><span class="line">    file_ind = <span class="number">0</span></span><br><span class="line">    folder = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">if</span> lob == <span class="string">&quot;finance&quot;</span> <span class="keyword">and</span> app == <span class="string">&quot;app1&quot;</span> <span class="keyword">and</span> c_type == <span class="string">&quot;consumer&quot;</span>:</span><br><span class="line">        mail_items, file_ind, folder = type1_msgs, <span class="number">0</span>, <span class="string">&quot;finance_files&quot;</span></span><br><span class="line">	<span class="keyword">elif</span> lob == <span class="string">&quot;marketing&quot;</span> <span class="keyword">and</span> app == <span class="string">&quot;app2&quot;</span> <span class="keyword">and</span> c_type == <span class="string">&quot;small business&quot;</span>:</span><br><span class="line">        mail_items, file_ind, folder = type2_msgs, <span class="number">1</span>, <span class="string">&quot;small business files&quot;</span></span><br><span class="line">	<span class="keyword">elif</span> lob == <span class="string">&quot;inventory&quot;</span> <span class="keyword">and</span> app == <span class="string">&quot;app3&quot;</span> <span class="keyword">and</span> c_type == <span class="string">&quot;cooperate&quot;</span>:</span><br><span class="line">        mail_items, file_ind, folder = type3_msgs, <span class="number">2</span>, <span class="string">&quot;cooperate files&quot;</span></span><br><span class="line">	<span class="keyword">else</span>:</span><br><span class="line">        mail_items = <span class="literal">None</span></span><br><span class="line">	path = <span class="string">r&quot;\\your file staing folder directory&quot;</span> + os.sep + folder</span><br><span class="line">    num_mails = <span class="built_in">len</span>(mail_items)</span><br><span class="line">    lst_mails = <span class="built_in">list</span>(<span class="built_in">reversed</span>(<span class="built_in">range</span>(num_mails)))</span><br><span class="line">    id_mail = lst_mail[<span class="number">0</span>]</span><br><span class="line">    email = mail_items[id_mail]</span><br><span class="line">    subject = email.Subject <span class="comment">## Outlook API Subject line object</span></span><br><span class="line">    <span class="keyword">if</span> file_ind <span class="keyword">in</span> (<span class="number">0</span>, <span class="number">2</span>):</span><br><span class="line">        num = -<span class="number">13</span> <span class="comment">## depends on your own situation</span></span><br><span class="line">        date_mail_str = subject[num:]</span><br><span class="line">        <span class="keyword">if</span> date_mail_str[<span class="number">0</span>] != <span class="string">&#x27; &#x27;</span>:</span><br><span class="line">            date_mail_dt = datetime.strptime(date_mail_str, <span class="string">&quot;%b. %d, %Y&quot;</span>)</span><br><span class="line">		<span class="keyword">else</span>:</span><br><span class="line">            date_mail_dt = datetime.strptime(date_mail_str, <span class="string">&quot; %b. %d, %Y&quot;</span>)</span><br><span class="line">	<span class="keyword">elif</span> file_ind == <span class="number">1</span> <span class="keyword">and</span> datetime.today().strftime(<span class="string">&quot;%a&quot;</span>) != <span class="string">&quot;Mon&quot;</span> <span class="keyword">and</span> datetime.today().day &lt;= <span class="number">10</span>:</span><br><span class="line">        date_mail_str = subject[-<span class="number">8</span>:-<span class="number">1</span>] + <span class="string">&#x27;2020&#x27;</span></span><br><span class="line">        date_mail_dt = datetime.strptime(date_mail_str, <span class="string">&quot; %B %d %Y&quot;</span>)</span><br><span class="line">	<span class="keyword">elif</span> file_ind == <span class="number">1</span> <span class="keyword">and</span> datetime.today().strftime(<span class="string">&quot;%a&quot;</span>) != <span class="string">&quot;Mon&quot;</span> <span class="keyword">and</span> datetime.today().day &lt;= <span class="number">10</span>:</span><br><span class="line">        date_mail_str = subject[-<span class="number">8</span>:-<span class="number">1</span>] + <span class="string">&#x27;2020&#x27;</span></span><br><span class="line">        date_mail_dt = datetime.strptime(date_mail_str, <span class="string">&quot;%B %d %Y&quot;</span>)</span><br><span class="line">	received_time = email.ReceivedTime <span class="comment">## Outlook API receive time object</span></span><br><span class="line">    today = datetime.today()</span><br><span class="line">    <span class="comment">## check availiability of the latest file</span></span><br><span class="line">    <span class="keyword">if</span> today.year == received_time.year <span class="keyword">and</span> today.month == received_time.month <span class="keyword">and</span> today.day == received_time.day:</span><br><span class="line">        avail_ind = <span class="number">1</span></span><br><span class="line">	<span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">raise</span> AttributeError(<span class="string">&quot;the latest file is not available! check with business team&quot;</span>)</span><br><span class="line">	<span class="comment">## check if the file is right copy</span></span><br><span class="line">    <span class="keyword">if</span> avail_ind == <span class="number">1</span> <span class="keyword">and</span> (file_ind == <span class="number">0</span> <span class="keyword">or</span> file_ind == <span class="number">1</span>):</span><br><span class="line">        val_dt = received_time - timedelta(days = <span class="number">1</span>)</span><br><span class="line">        <span class="keyword">if</span> date_mail_dt.day == val_dt.day <span class="keyword">and</span> date_mail_dt.month == val_dt.month <span class="keyword">and</span> date_mail_dt.year == val_dt.year:</span><br><span class="line">            valid_copy_ind = <span class="number">1</span> <span class="comment">## usually business file for current date is yesterday&#x27;s data if data is daily basis</span></span><br><span class="line">		<span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">raise</span> AttributeError(<span class="string">&quot;file copy is not right! check with business team&quot;</span>)</span><br><span class="line">	<span class="keyword">elif</span> avail_ind == <span class="number">1</span> <span class="keyword">and</span> file_ind == <span class="number">2</span>:</span><br><span class="line">        val_dt = received_time</span><br><span class="line">        <span class="keyword">if</span> date_mail_dt.day == val_dt.day <span class="keyword">and</span> date_mail_dt.month == val_dt.month <span class="keyword">and</span> date_mail_dt.year == val_dt.year:</span><br><span class="line">            valid_copy_ind = <span class="number">1</span> <span class="comment">## sometime current date file is current date data depends on business process</span></span><br><span class="line">		<span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">raise</span> AttributeError(<span class="string">&quot;file copy is not right! check with business team&quot;</span>)</span><br><span class="line">	<span class="keyword">if</span> valid_copy_ind == <span class="number">1</span>:</span><br><span class="line">        attachment = email.Attachment.item(<span class="number">1</span>)</span><br><span class="line">        report_name = attachment.FileName</span><br><span class="line">        os.chdir(path)</span><br><span class="line">        input_file = os.getcwd() + os.sep + date_mail_str + report_name</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(input_file):</span><br><span class="line">            attachment.SaveAsFile(input_file)</span><br><span class="line">            xltemp(input_file, file_ind)</span><br><span class="line"></span><br><span class="line">            </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    readMail()</span><br></pre></td></tr></table></figure>

<h2 id="Schedule-jobs-to-auto-check-your-inbox-and-execute-python-scripts"><a href="#Schedule-jobs-to-auto-check-your-inbox-and-execute-python-scripts" class="headerlink" title="Schedule jobs to auto check your inbox and execute python scripts"></a>Schedule jobs to auto check your inbox and execute python scripts</h2><p>If you use Linux as your local machine then there are so many scheduling tools such as <code>crontab</code>, for Windows users, you can use GUI tool <code>Task Scheduler</code> to to the automation scheduling task. In this case, we use <code>Task Scheduler</code>. </p>
<p><img src="/img/screenshots/taskscheduler.png" alt="taskscheduler.png"></p>
<p>simply follow the wizard to create local jobs to implement above readMail.py and pwdDery_module.py scripts. After decrypted Excel files push to your server then trigger server jobs so that make the whole data process automated, no more manual work.</p>
</div><div class="article-tags is-size-7 mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/tags/python-automation-ETL-Excel/">python, automation, ETL, Excel</a></div><div class="a2a_kit a2a_kit_size_32 a2a_default_style"><a class="a2a_dd" target="_blank" rel="noopener" href="https://www.addtoany.com/share"></a><a class="a2a_button_facebook"></a><a class="a2a_button_twitter"></a><a class="a2a_button_telegram"></a><a class="a2a_button_whatsapp"></a><a class="a2a_button_reddit"></a></div><script src="https://static.addtoany.com/menu/page.js" defer></script></article></div><!--!--><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/2020/12/17/Blocking-Process-Monitoring-and-Auto-Email-Notification-in-SQL-Server/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">Blocking Process Monitoring and Auto Email Notification in SQL Server</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/2020/12/14/Linux-Network-Management-Tool-nmcli/"><span class="level-item">Linux Network Management Tool nmcli</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><div class="card"><div class="card-content"><h3 class="title is-5">Comments</h3><div id="disqus_thread"><noscript>Please enable JavaScript to view the <a target="_blank" rel="noopener" href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div><script>var disqus_config = function () {
            this.page.url = 'https://hermanteng19.github.io/2020/12/15/Automation-Process-for-Email-Attachment-Excel-in-Python/';
            this.page.identifier = '2020/12/15/Automation-Process-for-Email-Attachment-Excel-in-Python/';
        };
        (function() {
            var d = document, s = d.createElement('script');  
            s.src = '//' + 'herman-hexo-blog' + '.disqus.com/embed.js';
            s.setAttribute('data-timestamp', +new Date());
            (d.head || d.body).appendChild(s);
        })();</script></div></div></div><div class="column column-left is-4-tablet is-4-desktop is-3-widescreen  order-1 is-sticky"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar is-rounded" src="/img/avatar1.png" alt="Herman"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">Herman</p><p class="is-size-6 is-block">Data Analyst&amp;Developer</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>Toronto, Canada</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">Posts</p><a href="/archives"><p class="title">21</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Categories</p><a href="/categories"><p class="title">6</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Tags</p><a href="/tags"><p class="title">19</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/HermanTeng19" target="_blank" rel="noopener">Follow</a></div><div class="level is-mobile"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/HermanTeng19"><i class="fab fa-github"></i></a></div></div></div><div class="card widget" id="toc" data-type="toc"><div class="card-content"><div class="menu"><h3 class="menu-label">Catalogue</h3><ul class="menu-list"><li><a class="level is-mobile" href="#Interact-Outlook-and-Excel-with-Python"><span class="level-left"><span class="level-item">1</span><span class="level-item">Interact Outlook and Excel with Python</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#fileTransfer-module-py"><span class="level-left"><span class="level-item">1.1</span><span class="level-item">fileTransfer_module.py</span></span></a></li><li><a class="level is-mobile" href="#excelOp-mudule-py"><span class="level-left"><span class="level-item">1.2</span><span class="level-item">excelOp_mudule.py</span></span></a></li><li><a class="level is-mobile" href="#pwdDecry-module-py"><span class="level-left"><span class="level-item">1.3</span><span class="level-item">pwdDecry_module.py</span></span></a></li><li><a class="level is-mobile" href="#readMail-py"><span class="level-left"><span class="level-item">1.4</span><span class="level-item">readMail.py</span></span></a></li></ul></li><li><a class="level is-mobile" href="#Schedule-jobs-to-auto-check-your-inbox-and-execute-python-scripts"><span class="level-left"><span class="level-item">2</span><span class="level-item">Schedule jobs to auto check your inbox and execute python scripts</span></span></a></li></ul></div></div><style>#toc .menu-list > li > a.is-active + .menu-list { display: block; }#toc .menu-list > li > a + .menu-list { display: none; }</style><script src="/js/toc.js" defer></script></div><div class="column-right-shadow is-hidden-widescreen"></div></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/avatar1.png" alt="Herman-blog" height="28"></a><p class="is-size-7"><span>&copy; 2022 Herman Teng</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p></div><div class="level-end"></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" async></script><script>moment.locale("en");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="Back to top" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "This website uses cookies to improve your experience.",
          dismiss: "Got it!",
          allow: "Allow cookies",
          deny: "Decline",
          link: "Learn more",
          policy: "Cookie Policy",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="Type something..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"Type something...","untitled":"(Untitled)","posts":"Posts","pages":"Pages","categories":"Categories","tags":"Tags"});
        });</script></body></html>